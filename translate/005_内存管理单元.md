# 5. 内存管理单元 (Memory Protection Unit)

该章节描述处理器的内存管理单元 MPU。包含以下部分：

- 关于 MPU
- MPU 功能描述
- MPU 编程模型



## 5.1. 关于 MPU (About the MPU)

MPU 是可选的内存管理组件。处理器支持标准的 ARMv7 保护内存系统架构 (ARMv7 Protected Memory System Architecture) 模型。MPU 提供了全部的支持：

- 分区保护 (protection regions)
- 保护区域重叠，优先级递增
  - 7 = 最高优先级
  - 0 = 最低优先级
- 访问权限
- 导出内存属性给系统



MPU 不匹配和权限违反将调用可编程优先级 (programmable-priority) 内存管理 fault 异常处理程序。更多详细信息参见 **ARMv7-M Architecture Reference Manual** 。

可以使用 MPU：

- 执行特权规则 (enforce privilege rules)
- 独立的进程 (sparate processes)
- 执行访问规则 (enforce access rules)



## 5.2. MPU 功能描述 (MPU functional description)

区域访问控制寄存器 (Region Access Control Register) 的 **TEX，C，AP 和 XN** 位控制着相关内存区域的访问。如果在没有所需权限的情况下对内存区域进行访问，则会产生权限 fault (permission fault) 异常。更多信息参见 **ARMv7-M Architecture Reference Manual** 。



## 5.3. MPU 编程模型 (MPU programmers model)

下表列出 MPU 的寄存器，在 **RMv7-M Architecture Reference Manual** 中对这些寄存器进行描述。

| 地址        | 名称        | 类型 | 复位值      | 描述                                                         |
| ----------- | ----------- | ---- | ----------- | ------------------------------------------------------------ |
| 0xE000_ED90 | MPU_TYPE    | RO   | 0x0000_0800 | MPU 类型寄存器                                               |
| 0xE000_ED94 | MPU_CTRL    | RW   | 0x0000_0000 | MPU 控制寄存器                                               |
| 0xE000_ED98 | MPU_RNR     | RW   | -           | MPU 区域号寄存器 (MPU Region Number Register)                |
| 0xE000_ED9C | MPU_RBAR    | RW   | -           | MPU 区域基地址寄存器 (MPU Region Base Address Register)      |
| 0xE000_EDA0 | MPU_RASR    | RW   | -           | MPU 区域属性和大小寄存器 (MPU Region Attribute and Size Register) |
| 0xE000_EDA4 | MPU_RBAR_A1 |      | -           | MPU 别名寄存器 (MPU alias registers)                         |
| 0xE000_EDA8 | MPU_RASR_A1 |      | -           |                                                              |
| 0xE000_EDAC | MPU_RBAR_A2 |      | -           |                                                              |
| 0xE000_EDB0 | MPU_RASR_A2 |      | -           |                                                              |
| 0xE000_EDB4 | MPU_RBAR_A3 |      | -           |                                                              |
| 0xE000_EDB8 | MPU_RASR_A3 |      | -           |                                                              |

注：如果 MPU 没有被实现，即不存在 MPU，则读 **MPU_TYPE** 寄存器将返回 0。