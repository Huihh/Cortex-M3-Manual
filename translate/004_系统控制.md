# 4. 系统控制 (System Control)

该章节描述为处理器编写程序的寄存器。包含以下部分：

- 关于系统控制
- 寄存器
- 寄存器描述



## 4.1. 关于系统控制 (About system control)

该章节描述控制处理器操作的寄存器。



## 4.2. 寄存器 (Register summary)

表 4-1 列出了系统控制的寄存器。本章节中没有描述的寄存器在 **ARMv7-M Architecture Reference Manual** 中描述。

| Address     | Name     | Type     | Reset                   | Description                                                  |
| ----------- | -------- | -------- | ----------------------- | ------------------------------------------------------------ |
| 0xE000_E008 | ACTLR    | RW       | 0x0000_0000             | 辅助控制寄存器 (ACTLR: Auxiliary Control Register)           |
| 0xE000_E010 | STCSR    | RW       | 0x0000_0000             | 滴答定时器控制和状态寄存器 (SysTick Control and Status Register) |
| 0xE000_E014 | STRVR    | RW       | Unknown                 | 滴答定时器重载值寄存器 (SysTick Reload Value Register)       |
| 0xE000_E018 | STCVR    | RW clear | Unknown                 | 滴答定时器当前值寄存器 (SysTick Current Value Register)      |
| 0xE000_E01C | STCR     | RO       | Implementation specific | 滴答定时器校准值寄存器 (SysTick Calibration Value Register)  |
| 0xE000_ED00 | CPUID    | RO       | 0x412FC230              | CPUID 基址寄存器                                             |
| 0xE000_ED04 | ICSR     | RW or RO | 0x0000_0000             | 中断控制和状态寄存器 (Interrupt Control and State Register)  |
| 0xE000_ED08 | VTOR     | RW       | 0x0000_0000             | 向量表偏移寄存器 (Vector Table Offset Register)              |
| 0xE000_ED0C | AIRCR    | RW       | 0x0000_0000             | 应用程序中断和复位控制寄存器 (Application Interrupt and Reset Control Register) |
| 0xE000_ED10 | SCR      | RW       | 0x0000_0000             | 系统控制寄存器 (System Control Register)                     |
| 0xE000_ED14 | CCR      | RW       | 0x0000_0200             | 配置和控制寄存器 (Configuration and Control Register)        |
| 0xE000_ED18 | SHPR1    | RW       | 0x0000_0000             | 系统处理优先级寄存器 1 (System Handler Priority Register 1)  |
| 0xE000_ED1C | SHPR2    | RW       | 0x0000_0000             | 系统处理优先级寄存器 2 (System Handler Priority Register 2)  |
| 0xE000_ED20 | SHPR3    | RW       | 0x0000_0000             | 系统处理优先级寄存器 3 (System Handler Priority Register 3)  |
| 0xE000_ED24 | SHCSR    | RW       | 0x0000_0000             | 系统处理控制二和状态寄存器 (System Handler Control and State Register) |
| 0xE000_ED28 | CFSR     | RW       | 0x0000_0000             | 配置 Fault 状态寄存器 (Configurable Fault Status Registers)  |
| 0xE000_ED2C | HFSR     | RW       | 0x0000_0000             | HardFault 状态寄存器 (Hardfault Status Register)             |
| 0xE000_ED30 | DFSR     | RW       | 0x0000_0000             | 调试 Fault 状态寄存器 (Debug Fault Status Register)          |
| 0xE000_ED34 | MMFAR    | RW       | Unknown                 | 内存管理地址寄存器 (MemManage Address Register)              |
| 0xE000_ED38 | BFAR     | RW       | Unknown                 | BusFault 地址寄存器 (BusFault 地址寄存器)                    |
| 0xE000_ED3C | AFSR     | RW       | 0x0000_0000             | 辅助 Fault 状态寄存器 (Auxiliary Fault Status Register)      |
| 0xE000_ED40 | ID_PFR0  | RO       | 0x0000_0030             | 处理器特点寄存器 0 (Processor Feature Register 0)            |
| 0xE000_ED44 | ID_PFR1  | RO       | 0x0000_0200             | 处理器特点寄存器 1 (Processor Feature Register 1)            |
| 0xE000_ED48 | ID_DFR0  | RO       | 0x0010_0000             | 调试特点寄存器 1 (Debug Feature Register 0)                  |
| 0xE000_ED4C | ID_AFR0  | RO       | 0x0000_0000             | 辅助特点寄存器 1 (Auxiliary Feature Register 0)              |
| 0xE000_ED50 | ID_MMFR0 | RO       | 0x0000_0030             | 内存模型特点寄存器 0 (Memory Model Feature Register 0)       |
| 0xE000_ED54 | ID_MMFR1 | RO       | 0x0000_0000             | 内存模型特点寄存器 1 (Memory Model Feature Register 1)       |
| 0xE000_ED58 | ID_MMFR2 | RO       | 0x0000_0000             | 内存模型特点寄存器 2 (Memory Model Feature Register 2)       |
| 0xE000_ED5C | ID_MMFR3 | RO       | 0x0000_0000             | 内存模型特点寄存器 3 (Memory Model Feature Register 3)       |
| 0xE000_ED60 | ID_ISAR0 | RO       | 0x0114_1110             | 指令集属性寄存器 0 (Instruction  Set Attributes Register 0)  |
| 0xE000_ED64 | ID_ISAR1 | RO       | 0x0211_2000             | 指令集属性寄存器 1 (Instruction  Set Attributes Register 1)  |
| 0xE000_ED68 | ID_ISAR2 | RO       | 0x2123_2231             | 指令集属性寄存器 2 (Instruction  Set Attributes Register 2)  |
| 0xE000_ED6C | ID_ISAR3 | RO       | 0x0111_1131             | 指令集属性寄存器 3 (Instruction  Set Attributes Register 3)  |
| 0xE000_ED70 | ID_ISAR4 | RO       | 0x0131_0102             | 指令集属性寄存器 4(Instruction  Set Attributes Register 4)   |
| 0xE000_ED88 | CPACR    | RW       | 0x0000_0000             | 协处理访问控制寄存器 (Coprocessor Access Control Register)   |
| 0xE000_EF00 | STIR     | WO       | 0x0000_0000             | 软件触发中断寄存器 (Software Triggered Interrupt Register)   |

- **AIRCR** 中 bit[10:8] 复位为 0。 **ENDIANNESS** 位，即 bit[15]，可以复位为其它状态，取决于实现时指定。
- **BFAR** 和 **MMFAR** 是同一个物理寄存器。因此，**BFARVALID** 和 **MFAEVALID** 位是相互排斥的。



## 4.3. 寄存器描述 (Register descriptions)

描述特定为 Cortex-M3 处理器实现的系统控制寄存器。



### 4.3.1. 辅助控制寄存器，ACTLR (Auxiliary Control Register)

ACTLR 寄存器的特点：

- 目的：禁用处理器中的某些功能。
- 用法限制：没有。
- 配置：在所有处理器配置中该寄存器都是有效的。
- 属性：如下表所示。

##

![](E:\Work\ARM\pictures\Chapter 3\Snipaste_2019-07-09_17-49-42.png)

| 位     | 名称       | 功能                                                         |
| ------ | ---------- | ------------------------------------------------------------ |
| [31:3] | -          | 保留                                                         |
| [2]    | DISFOLD    | 禁用折叠 **IT** 指令 (Disables folding of **IT** instructions) |
| [1]    | DISDEFWBUF | 禁用在默认内存映射访问期间使用写缓冲区。这样方便定位 BusFault，但是会降低处理器的性能，因为存储到内存的操作必须在执行下一条指令之前完成。**Tips: 可在调试阶段定位引起总线错误的问题** |
| [0]    | DISMCYCINT | 禁用多周期指令中断。这增加了处理器的中断延迟，因为加载/存储和乘/除操作在中断入栈发生之前就要完成了。 |



### 4.3.2. CPUID 基址寄存器，CPUID (CPUID Base Register)

CPUID 寄存器特点：

- 目的：
  - 处理器内核的 ID 号。
  - 处理器内核的版本号。
  - 处理器内核的实现细节。
- 用法限制：没有。
- 配置：在所有处理器配置中该寄存器都是有效的。
- 属性：如下表所示。

![](E:\Work\ARM\pictures\Chapter 3\Snipaste_2019-07-09_18-02-45.png)

| 位      | 名称        | 功能                                 |
| ------- | ----------- | ------------------------------------ |
| [31:24] | IMPLEMENTER | 表示实现者 如：0x41 = ARM            |
| [23:20] | VARIANT     | 表示处理器的修订版：0x2 = Revision 2 |
| [19:16] | (Constant)  | Reads as 0xF                         |
| [15:4]  | PARTNO      | 表示部分号：0xC23 = Coretx-M3        |
| [3:0]   | REVISION    | 表示补丁发布：0x0 = Patch 0          |



### 4.3.3. 辅助 Fault 状态寄存器，AFSR (Auxiliary Fault Status Register)

AFSR 寄存器特点：

- 目的：为软件指定额外的 **fault** 信息。
- 用法限制：AFSR flags 直接映射到处理器的 **AUXFAULT** 输入，外部引脚上的单周期高电平导致相应的AFSR 位被锁存为 1。该位只能通过写入 1 到对应的 AFSR 位来清除。
  当 AFSR 位被写入或锁存为 1 时，不会发生异常。如果需要异常，则必须使用中断。
- 配置：在所有处理器配置中该寄存器都是有效的。
- 属性：如下表所示。

![](E:\Work\ARM\pictures\Chapter 3\Snipaste_2019-07-09_18-18-52.png)

| 位     | 名称     | 功能                                                         |
| ------ | -------- | ------------------------------------------------------------ |
| [31:0] | AUXFAULT | **AUXFAULT** 输入的锁定版本 (Latched version of the **AUXFAULT** inputs) |

